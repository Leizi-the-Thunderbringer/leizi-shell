# 🗺️ Leizi Shell 开发路线图
> **计划周期**: 2025年9月26日 - 2026年6月15日 (约8.5个月)

## 📖 项目现状概览

### 当前版本: v1.1.1 (开发中)
**最新成就** (2025-09-26):
- ✅ **作业控制系统**: 完整的后台作业管理(`&`, `jobs`, `fg`, `bg`, Ctrl+Z)
- ✅ **管道支持**: 完整的命令管道功能 (`|`)
- ✅ **I/O重定向**: 支持所有标准重定向操作符 (`>`, `>>`, `<`, `2>`, `2>>`, `&>`)
- ✅ **项目重命名**: 从"lezi"统一重命名为"leizi"

### 技术债务与挑战
- **单体架构**: `src/main.cpp` (2000+行) 急需模块化重构
- **测试覆盖率**: 目前仅有基础 shell 脚本测试
- **文档完整性**: API文档和用户指南有待完善
- **包分发**: 缺乏主流包管理器支持

---

## 🎯 特殊时期协作模式
> 考虑到中考备战期间的特殊情况 (2025年9月-2026年6月)

### AI 主导开发模式
- **AI 响应**: Claude AI 处理 80% 的 issue 和 PR
- **人工监督**: @Amiya167 进行关键决策和安全审查
- **质量保证**: 自动化测试和 CI/CD 确保代码质量
- **异步协作**: 24-48小时响应周期，避免实时依赖

### 优先级调整
1. **HIGH**: 自动化和工具化优先
2. **MEDIUM**: 核心功能稳步推进
3. **LOW**: 高级功能延后至2026年下半年

---

## 🚀 第一阶段: 基础设施完善 (2025年9月-11月)

### v1.2.0 目标发布: 2025年11月30日

#### 核心任务
- **TASK-003: 代码模块化重构** ⭐ `CRITICAL` ✅ **已完成** (2025-10-03)
  - 目标: 将单体 `main.cpp` 拆分为模块化架构
  - 预计工作量: 2-3周
  - 优先级: 为后续开发奠定基础
  ```
  src/
  ├── core/       # Shell核心、解析器、执行器
  ├── builtin/    # 内建命令模块化 ✅
  ├── prompt/     # 提示符和Git集成 ✅
  ├── completion/ # 自动补全系统
  └── utils/      # 工具和信号处理 ✅
  ```
  - [x] 颜色常量抽离至 `src/utils/colors.h`（2025-10-01）
  - [x] 引入 `VariableManager`（`src/utils/variables.*`）统一变量管理（2025-10-01）
  - [x] 创建 `src/prompt/prompt.h/.cpp` - 提取提示符生成逻辑（2025-10-01）
  - [x] 创建 `src/core/parser.h/.cpp` - 提取命令解析逻辑（2025-10-01）
  - [x] 创建 `src/prompt/git.h/.cpp` - 提取 Git 集成功能（2025-10-02）
  - [x] 创建 `src/core/job_control.h/.cpp` - 作业控制模块（2025-10-02）
  - [x] 创建 `src/utils/signal_handler.h/.cpp` - 信号处理模块（2025-10-02）
  - [x] 创建 `src/builtin/builtin.h` - 内建命令基类框架（2025-10-02）
  - [x] **内建命令模块化实现** (2025-10-03) ✨
    - [x] `src/builtin/cd.cpp` - cd 命令实现
    - [x] `src/builtin/echo.cpp` - echo 命令实现
    - [x] `src/builtin/export.cpp` - export/unset 命令实现
    - [x] `src/builtin/array.cpp` - array 命令实现
    - [x] `src/builtin/history.cpp` - history 命令实现
    - [x] `src/builtin/simple.cpp` - pwd/exit/clear 命令实现
    - [x] `src/builtin/info.cpp` - help/version 命令实现
    - [x] `src/builtin/builtin_manager.h/.cpp` - 统一的内建命令管理器
    - [x] 更新 `main.cpp` 集成新的模块化系统
    - [x] 编译通过并验证功能无回归

**重大进展**: 🎉 内建命令模块化重构全部完成！项目结构显著改善，为后续开发奠定了坚实基础。

- **TASK-011: 完善测试套件** ⭐ `HIGH`
  - 建立单元测试框架 (Catch2/Google Test)
  - 集成测试覆盖管道、重定向、作业控制
  - 目标覆盖率: 80%+
  - BATS 功能测试自动化

#### 用户体验提升
- **TASK-008: 增强自动补全系统**
  - 智能命令参数补全
  - 历史命令补全
  - 变量名补全支持

- **TASK-009: 配置系统实现**
  - `~/.config/leizi/config.toml` 支持
  - 提示符、补全、历史记录可配置
  - 别名系统基础实现

### 里程碑检查点
- **2025年10月15日**: 模块化重构完成
- **2025年11月15日**: 测试套件达到 80% 覆盖率
- **2025年11月30日**: v1.2.0 正式发布

---

## 🛠️ 第二阶段: 功能扩展与优化 (2025年12月-2026年2月)

### v1.3.0 目标发布: 2026年2月28日

#### 高级功能开发
- **TASK-010: 语法高亮实现**
  - Fish Shell 风格的实时语法高亮
  - 命令有效性检查
  - 性能优化 (输入延迟 < 10ms)

#### 质量与性能
- **TASK-012: 内存安全和性能优化**
  - AddressSanitizer 集成
  - Valgrind 内存泄漏检测
  - 启动时间优化 (< 50ms)
  - 提示符生成优化 (< 10ms)

#### 开发者体验
- **TASK-013: 完善文档体系**
  - 用户指南和API文档
  - Doxygen 自动文档生成
  - 多语言文档支持
  - 实用示例和教程

### 里程碑检查点
- **2025年12月31日**: 语法高亮功能完成
- **2026年1月31日**: 性能优化达标
- **2026年2月28日**: v1.3.0 发布

---

## 📦 第三阶段: 生态建设 (2026年3月-5月)

### v1.4.0 目标发布: 2026年5月31日

#### 包管理器支持
- **TASK-014: 多平台包分发**
  - **Homebrew Formula** (macOS): 优先级最高
  - **APT Repository** (Ubuntu/Debian): Linux 主流
  - **AUR Package** (Arch Linux): 开发者友好
  - **Docker 镜像**: 容器化支持
  - **自动化发布**: GitHub Actions 集成

#### 具体实现计划
```yaml
# 自动化发布流程
Release Trigger → Multiple Package Builds → Parallel Updates
    ↓                      ↓                      ↓
GitHub Release    →    Build & Test        →   Package Managers
                       - .deb packages          - Homebrew tap
                       - Docker images          - AUR PKGBUILD
                       - Binary releases        - APT repository
```

### 社区建设
- **贡献者指南**: 简化新人参与流程
- **Issue 模板**: 标准化问题报告
- **CI/CD 完善**: 多平台自动化测试

---

## 🌟 第四阶段: 高级特性预研 (2026年6月前)

### v2.0.0 预览版准备

#### 脚本语言功能 (预研阶段)
- **TASK-015: Shell 脚本支持**
  - 函数定义和调用
  - 条件语句 (`if`, `case`)
  - 循环结构 (`for`, `while`)
  - 算术表达式计算

#### 现代化特性探索
- 插件系统架构设计
- 网络集成功能调研
- 云原生工具集成规划

---

## 📊 版本发布时间线

```
2025年9月  ├─ v1.1.1 ✅ (作业控制)
          │
2025年11月 ├─ v1.2.0 📋 (模块化 + 测试)
          │   ├─ 代码重构完成
          │   ├─ 测试覆盖率80%+
          │   └─ 配置系统上线
          │
2026年2月  ├─ v1.3.0 🎨 (体验优化)
          │   ├─ 语法高亮
          │   ├─ 性能优化
          │   └─ 文档完善
          │
2026年5月  ├─ v1.4.0 📦 (生态完善)
          │   ├─ 多平台包支持
          │   ├─ 自动化发布
          │   └─ 社区工具
          │
2026年6月  └─ v2.0.0-preview 🚀 (未来特性预览)
             ├─ 脚本语言支持
             └─ 插件系统设计
```

---

## 🎓 中考期间特别安排

### 减负策略 (2025年9月 - 2026年6月)
- **自动化优先**: 减少人工干预需求
- **稳定性第一**: 避免破坏性更改
- **渐进式开发**: 小步快跑，每次迭代功能完整
- **AI协助开发**: 最大化 AI 工具使用效率

### 人力资源安排
- **@Amiya167**: 架构决策、安全审查、发布管理
- **@HwlloChen**: 专注学业，期间暂停开发参与
- **Claude AI**: 日常开发、测试、文档、issue 处理

### 应急响应机制
- **关键bug**: 24小时内 AI 响应，48小时内人工确认
- **安全问题**: 立即人工介入
- **架构变更**: 需要 @Amiya167 明确批准

---

## 🎯 成功指标 (KPIs)

### 技术指标
- **代码质量**: 测试覆盖率 > 80%
- **性能基准**: 启动时间 < 50ms，提示符 < 10ms
- **稳定性**: 内存泄漏为零，无未定义行为
- **兼容性**: 通过 POSIX shell 标准测试

### 用户指标
- **安装体验**: 5分钟内完成安装配置
- **学习曲线**: 新用户30分钟内掌握基本功能
- **文档完整性**: API 文档覆盖率 100%

### 生态指标
- **包管理器**: 4大平台包支持 (Homebrew, APT, AUR, Docker)
- **社区活跃度**: GitHub stars > 500, issues 响应时间 < 48h
- **发布节奏**: 稳定的季度发布周期

---

## 🔄 风险管控

### 主要风险识别
1. **人力资源风险**: 核心开发者学业压力
   - **缓解措施**: AI 主导开发，自动化流程

2. **技术债务风险**: 单体架构限制扩展性
   - **缓解措施**: 优先进行模块化重构

3. **质量风险**: 快速开发可能引入 bug
   - **缓解措施**: 强化测试体系，CI/CD 自动化

4. **社区风险**: 响应延迟影响用户体验
   - **缓解措施**: AI 自动响应，clear communication

### 应急预案
- **开发停滞**: 激活维护模式，专注稳定性
- **重大 bug**: 紧急热修复流程
- **性能回归**: 版本回滚和性能测试加强

---

## 📈 长远愿景 (2026年后)

### v2.0+ 规划
- **现代脚本语言**: 完整的 shell 脚本支持
- **插件生态**: 丰富的第三方插件市场
- **云原生集成**: 容器、K8s、云服务支持
- **跨平台统一**: Windows WSL 完美支持

### 成为现代 Shell 的标杆
- 性能超越传统 shell
- 用户体验媲美现代 IDE
- 社区驱动的功能发展
- 企业级稳定性保证

---

## 🤝 社区参与

### 贡献欢迎
即使在特殊时期，我们仍然欢迎社区贡献：
- **Bug 报告**: 详细的问题描述和复现步骤
- **功能建议**: 在 GitHub Issues 中讨论
- **代码贡献**: 遵循贡献指南，小 PR 优先
- **文档改进**: 用户文档和示例完善

### 加入我们
- 💬 **Discussion**: GitHub Discussions
- 🐛 **Issues**: Bug reports and feature requests
- 📝 **Wiki**: Community-maintained documentation
- 🏷️ **Labels**: 使用 `[AI-Generated]`, `[Needs-Human-Review]` 等标签

---

**路线图最后更新**: 2025年9月26日
**负责人**: @Amiya167, Claude AI
**版本**: v1.0
**下次更新**: 2025年12月1日 (v1.2.0 发布后)

---

> 💪 让我们一起为恺源加油！期待2026年中考后他带着更强的技能回归，共同将 Leizi Shell 推向新的高度！🎓✨
